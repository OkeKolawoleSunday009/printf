#include "main.h"
#include <stdio.h>
#include <stdarg.h>
#include <stdlib.h>

void handle_flags(char** format, int* flag_plus, int* flag_space, int* flag_hash) 
{
    while (1) {
        if (**format == '+') {
            *flag_plus = 1;
        } else if (**format == ' ') {
            *flag_space = 1;
        } else if (**format == '#') {
            *flag_hash = 1;
        } else {
            break;
        }
        (*format)++;
    }
}

void my_printf(const char* format, ...)
{
    va_list args;
    int count, flag_plus, flag_space, flag_hash;;
   
    va_start(args, format);
     count = 0;

    while (*format != '\0') {
        if (*format == '%') {
            format++;
            flag_plus = 0;
            flag_space = 0;
            flag_hash = 0;

            handle_flags(&format, &flag_plus, &flag_space, &flag_hash);

            switch (*format) {
                case 'c': {
                    count += print_char(va_arg(args, int));
                    break;
                }
                case 's': {
                    char* value = va_arg(args, char*);
                    count += print_string(value);
                    break;
                }
                case '%': {
                    count += print_percent();
                    break;
                }
                case 'd':
                case 'i': {
                    int value = va_arg(args, int);
                    count += print_d(value, flag_plus, flag_space);
                    break;
                }
                case 'o': {
                    unsigned int value = va_arg(args, unsigned int);
                    count += print_octa(value, flag_hash);
                    break;
                }
                case 'b': {
                    unsigned int value = va_arg(args, unsigned int);
                    count += print_binary(value);
                    break;
                }
                case 'x':
                case 'X': {
                    unsigned int value = va_arg(args, unsigned int);
                    count += print_hex(value, flag_hash, (*format == 'X'));
                    break;
                }
                case 'u': {
                    unsigned int value = va_arg(args, unsigned int);
                    count += print_u(value);
                    break;
                }
                case 'p': {
                    void* value = va_arg(args, void*);
                    count += print_py(value);
                    break;
                }
                case 'S': {
                    char* value = va_arg(args, char*);
                    count += print_special(value);
                    break;
                }
                default:
                    count += _putchar(*format);
                    break;
            }
        } else {
            count += _putchar(*format);
        }
        format++;
    }

    va_end(args);
}


